<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>瀑布流布局JS实现</title>
    <script src=" http://libs.baidu.com/jquery/1.11.1/jquery.min.js "></script>
    <style type="text/css">
        * {
            margin: 0;
            padding: 0;
        }

        #main {
            position: relative;
        }

        .pin {
            float: left;
            padding: 15px 0 0 15px;
        }

        .box {
            border: 1px solid #ccc;
            box-shadow: 0 0 6px #ccc;
            border-radius: 5px;
        }

        .img {
            width: 162px;
            height: auto;
        }
    </style>
    <script type="text/javascript">
        $(window).on('load', function () {
            walkFlow();

            var dicData = { 'data': [] };
            for (var i = 22; i < 98; i++) {
                var obj = { 'src': '' + i + '.jpg' };
                dicData.data.push(obj);
            }

            $(window).on('scroll', function () {
                if (checkLoadPicData()) {
                    $.each(dicData.data, function (index) {
                        var divPin = $('<div>').addClass('pin');
                        $('#main').append(divPin);
                        var divBox = $('<div>').addClass('box');
                        divPin.append(divBox);
                        var img = $('<img>').attr("src", './images/' + dicData.data[index].src);
                        divBox.append(img);
                    });
                    walkFlow();
                }
            });
        })
        function checkLoadPicData() {
            var clientHeight = $(window).height();
            var scrollTop = $(document).scrollTop();
            var $boxs = $('#main>div').last();
            var height = Math.floor($boxs.height() / 2) + $boxs.offset().top;
            return (height < clientHeight + scrollTop) ? true : false;
        }
        function walkFlow() {
            var $boxs = $('#main>div');
            var boxW = $boxs.eq(0).outerWidth();
            var clientW = $(window).width();
            var cols = Math.floor(clientW / boxW);
            $('main').css({ "width": cols * boxW + "px", "margin": "0 auto" });
            var arrBox = [];
            $boxs.each(function (i) {
                var _this = $(this);
                if (i < cols) {
                    arrBox.push(_this.height());
                } else {
                    var minH = Math.min.apply(null, arrBox);
                    var index = $.inArray(minH, arrBox);
                    _this.css({
                        "top": minH + "px",
                        "left": $boxs.eq(index).offset().left + "px",
                        "position": "absolute"
                    })
                    arrBox[index]+=_this.height()
                }
            });
        }
    </script>
</head>
<body>
    <div id="main">
        <div class="pin">
            <div class="box">
                <img src="./images/1.jpg" />
            </div>
        </div>
        <div class="pin">
            <div class="box">
                <img src="./images/2.jpg" />
            </div>
        </div>
        <div class="pin">
            <div class="box">
                <img src="./images/3.jpg" />
            </div>
        </div>
        <div class="pin">
            <div class="box">
                <img src="./images/4.jpg" />
            </div>
        </div>
        <div class="pin">
            <div class="box">
                <img src="./images/5.jpg" />
            </div>
        </div>
        <div class="pin">
            <div class="box">
                <img src="./images/6.jpg" />
            </div>
        </div>
        <div class="pin">
            <div class="box">
                <img src="./images/7.jpg" />
            </div>
        </div>
        <div class="pin">
            <div class="box">
                <img src="./images/8.jpg" />
            </div>
        </div>
        <div class="pin">
            <div class="box">
                <img src="./images/9.jpg" />
            </div>
        </div>
        <div class="pin">
            <div class="box">
                <img src="./images/10.jpg" />
            </div>
        </div>
        <div class="pin">
            <div class="box">
                <img src="./images/11.jpg" />
            </div>
        </div>
        <div class="pin">
            <div class="box">
                <img src="./images/12.jpg" />
            </div>
        </div>
        <div class="pin">
            <div class="box">
                <img src="./images/13.jpg" />
            </div>
        </div>
        <div class="pin">
            <div class="box">
                <img src="./images/14.jpg" />
            </div>
        </div>
        <div class="pin">
            <div class="box">
                <img src="./images/15.jpg" />
            </div>
        </div>
        <div class="pin">
            <div class="box">
                <img src="./images/16.jpg" />
            </div>
        </div>
        <div class="pin">
            <div class="box">
                <img src="./images/17.jpg" />
            </div>
        </div>
        <div class="pin">
            <div class="box">
                <img src="./images/18.jpg" />
            </div>
        </div>
        <div class="pin">
            <div class="box">
                <img src="./images/19.jpg" />
            </div>
        </div>
        <div class="pin">
            <div class="box">
                <img src="./images/20.jpg" />
            </div>
        </div>
        <div class="pin">
            <div class="box">
                <img src="./images/21.jpg" />
            </div>
        </div>
    </div>
</body>
</html>
